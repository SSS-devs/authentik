---
title: Force password reset on next login
---

It's possible to utilize expression policies, custom stages, and a custom user attribute to force users to reset their password on next login. This guide describes how to configure this in conjunction with the `default-authentication-flow`, however the same process can be used with any authentication flow.

## Create expression policies

You will need to create two expression policies; a policy that checks the value of a custom user attribute on whichever user account is attempting to login, and a policy that resets the value of the custom user attribute.

1. Log in to authentik as an administrator and open the authentik Admin interface.
2. Navigate to **Customization** > **Policies** and click **Create** to create the first policy.
3. Select **Expression Policy** as the policy type, click **Next**, and configure the following settings:
    - **Name**: Provide a descriptive name for the policy (e.g. `reset_password_check`).
    - **Expression**:

        ```python
        # Check if user has the "reset_password" attribute set to true
        if request.context["pending_user"].attributes.get("reset_password") == True:
            return True

        return False
        ```

4. Click **Finish** to create the policy and repeat the process to create the second policy with the following settings:
    - **Name**: Provide a descriptive name for the policy (e.g. `reset_password_update`).
    - **Expression**:

        ```python
        # Check if user has the "reset_password" attribute set to true
        if request.context["pending_user"].attributes.get("reset_password") == True:
            # Sets the user's "reset_password" attribute set to false so that they're not forced to reset their password upon next login
            request.context["pending_user"].attributes["reset_password"] = False
            return True

        return False
        ```

5. Click **Finish**.

## Create stages

You will need to create two stages; a prompt stage to prompt the user for a new password, and a user write stage to write the new password to the user's account. Both of these stages will need to be bound to the authentication flow that's in use, usually the `default-authentication-flow`.

1. Log in to authentik as an administrator and open the authentik Admin interface.
2. Navigate to **Flows and Stages** > **Flows** and click on the name of the authentication policy that's in use (e.g. `default-authentication-flow`).
3. Select the **Stage Bindings** tab and click **Create and bind stage**.
4. Select **Prompt Stage** as the stage type, click **Next**, and configure the following settings for the stage:
    - **Name**: Provide a descriptive name for the stage (e.g. `Force Password Reset Prompt Stage`).
    - Under **Fields**:
        - Click the `x` icon between **Available Fields** and **Selected Fields** to clear the selections.
        - Select `default-password-change-field-password` and `default-password-change-field-password-repeat`.
    - Under **Validation Policies**:
        - Click the `x` icon between **Available Policies** and **Selected Policies** to clear the selections.
        - _(Optional but recommended)_ Select `default-password-change-policy`.

:::tip
Optionally, create a text field that explains to the user that they're being forced to reset their password. This text field can be added to the prompt stage. See the [Prompt Stage documentation](../add-secure-apps/flows-stages/stages/prompt/index.md#Prompt) for more information.
:::

5. Click **Next** to creat the stage and then configure the following settings for the binding:
    - **Order**: `25` or any number higher than the `default-authentication-password` stage order and lower than the `default-authentication-mfa-validation` stage order.
    - Leave the other settings as their default values.

6. Click **Finish** to create the binding and repeat the process for the second stage using the following settings:
    - **Stage type**: Select **User Write Stage** as the type.
    - **Name**: Provide a descriptive name for the stage (e.g. `Force Password Reset User Write Stage`).
    - Leave the other settings as their default values.

7. Click **Next** to create the stage and then configure the following settings for the binding:
    - **Order**: `26` or any number higher than the `Force Password Reset Prompt Stage` stage order and lower than the `default-authentication-mfa-validation` stage order.
    - Leave the other settings as their default values.

8. Click **Finish** to create the binding

## Bind policies to stages

You will need to bind the previously created policies to the newly created stages. Specifically:

    - The `reset_password_check` policy needs to be bound to the `Force Password Reset Prompt Stage`.
    - The `reset_password_update` policy needs to be bound to the `Force Password Reset User Write Stage`.

1. Log in to authentik as an administrator and open the authentik Admin interface.
2. Navigate to **Flows and Stages** > **Flows** and click on the name of the authentication policy that's in use (e.g. `default-authentication-flow`).
3. Select the **Stage Bindings** tab and click the arrow next to the newly created `Force Password Reset Prompt Stage` to expand it.
4. Click **Bind existing Policy / Group / User**.
5. Set **Policy** to `reset_password_check` and click **Create**.
6. Click the arrow next to the newly created `Force Password Reset User Write Stage` to expand it.
7. Click **Bind existing Policy / Group / User**.
8. Set **Policy** to `reset_password_update` and click **Create**.

## Set custom user attribute

To force a user to reset their password on next login, you will need to set a custom user attribute on their account.

1. Log in to authentik as an administrator and open the authentik Admin interface.
2. Navigate to **Directory** > **Users** and click the **Edit** icon of the user in question.
3. Add the following values to the user's attribute field:
    ```python
    reset_password: True
    ```
4. Click **Update**.

The next time the user logs in, they will be forced to reset their password.
